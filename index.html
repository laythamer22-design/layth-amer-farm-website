<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Royal Oasis | Advanced Accounting & Security</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
        :root { --gold: #c5a059; --dark: #050505; }
        body { font-family: 'Tajawal', sans-serif; background: var(--dark); color: white; }
        .glass { background: rgba(255,255,255,0.02); backdrop-filter: blur(20px); border: 1px solid rgba(197,160,89,0.2); border-radius: 35px; }
        input, select, textarea { background: #000 !important; border: 1px solid #333 !important; color: var(--gold) !important; border-radius: 12px; padding: 12px; outline: none; }
        input[readonly] { background: rgba(34, 197, 94, 0.1) !important; border-color: #22c55e !important; }
        
        /* ØªØµÙ…ÙŠÙ… Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª */
        .ledger-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .ledger-table th { background: var(--gold); color: black; padding: 10px; }
        .ledger-table td { border-bottom: 1px solid #222; padding: 10px; text-align: center; }
        
        #adminOS, #staffOS { display: none; position: fixed; inset: 0; z-index: 9999; background: #050505; padding: 30px; overflow-y: auto; }
    </style>
</head>
<body>

    <nav class="p-6 flex justify-between items-center backdrop-blur-md fixed w-full z-50">
        <h1 class="text-2xl font-black text-gold italic">Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</h1>
        <div class="flex gap-2">
            <button onclick="auth('staff')" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-[10px] font-bold">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¸Ù</button>
            <button onclick="auth('admin')" class="bg-gold text-black px-4 py-2 rounded-xl text-[10px] font-bold">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</button>
        </div>
    </nav>

    <div class="pt-32 px-6 max-w-4xl mx-auto pb-20">
        <div class="glass p-10">
            <h2 class="text-3xl font-black text-gold text-center mb-8">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ«Ù‚ Ø¨Ø§Ù„Ù‡ÙˆÙŠØ©</h2>
            
            <div class="space-y-6">
                <div>
                    <label class="text-xs text-gold/60 block mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„ (Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©):</label>
                    <input type="text" id="custName" class="w-full text-lg" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <input type="tel" id="custPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                    <input type="text" id="bookDate" placeholder="Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²">
                </div>

                <div class="p-6 border-2 border-dashed border-gray-800 rounded-3xl text-center">
                    <p class="text-[10px] text-red-400 mb-4 font-bold">ğŸ”’ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ Ù„Ù„Ù…Ø³ØªÙ…Ø³ÙƒØ§Øª (Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© + Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³ÙƒÙ†)</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div id="boxId" class="bg-black/50 p-4 rounded-xl border border-gray-700">
                            <span class="block text-[9px] mb-2">Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©</span>
                            <input type="file" id="fId" class="text-[9px]" onchange="validateID(this, 'boxId')">
                        </div>
                        <div id="boxRes" class="bg-black/50 p-4 rounded-xl border border-gray-700">
                            <span class="block text-[9px] mb-2">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³ÙƒÙ†</span>
                            <input type="file" id="fRes" class="text-[9px]" onchange="validateID(this, 'boxRes')">
                        </div>
                    </div>
                </div>

                <div class="bg-gold/5 p-6 rounded-2xl border border-gold/20 flex justify-between items-center">
                    <span class="font-bold">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø¬Ø²:</span>
                    <span class="text-2xl font-black text-gold"><span id="totalPrice">600,000</span> Ø¯.Ø¹</span>
                </div>

                <button id="bookBtn" onclick="confirmAndLog()" disabled class="w-full py-6 bg-gray-800 text-white rounded-3xl font-black text-xl opacity-30 cursor-not-allowed">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</button>
            </div>
        </div>
    </div>

    <div id="staffOS">
        <div class="flex justify-between items-center mb-8 border-b border-blue-500 pb-4">
            <h2 class="text-2xl font-black text-blue-500">Ø³Ø¬Ù„ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·)</h2>
            <button onclick="location.reload()" class="bg-red-600 px-6 py-2 rounded-xl text-xs">Ø®Ø±ÙˆØ¬</button>
        </div>
        <div class="overflow-x-auto">
            <table class="ledger-table">
                <thead>
                    <tr><th>Ø§Ù„Ø²Ø¨ÙˆÙ†</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr>
                </thead>
                <tbody id="staffTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="adminOS">
        <div class="flex justify-between items-center mb-8 border-b border-gold pb-4">
            <h2 class="text-2xl font-black text-gold italic">Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</h2>
            <button onclick="location.reload()" class="bg-red-600 px-6 py-2 rounded-xl text-xs">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div class="grid md:grid-cols-3 gap-6 mb-10">
            <div class="bg-green-600/20 p-6 rounded-2xl border border-green-600">
                <span class="text-xs block">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙƒÙ„ÙŠØ©</span>
                <h3 class="text-2xl font-black" id="totalLedgerSum">0 Ø¯.Ø¹</h3>
            </div>
            <div class="bg-blue-600/20 p-6 rounded-2xl border border-blue-600">
                <span class="text-xs block">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©</span>
                <h3 class="text-2xl font-black" id="totalBookingsCount">0</h3>
            </div>
            <button onclick="clearLedger()" class="bg-red-600/10 text-red-500 p-6 rounded-2xl border border-red-500 text-xs font-bold">ØªØµÙÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)</button>
        </div>

        <h4 class="text-gold font-bold mb-4 underline">Ø¯ÙØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ:</h4>
        <div class="overflow-x-auto glass p-4 mb-10">
            <table class="ledger-table" id="masterLedgerTable">
                <thead>
                    <tr><th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²</th><th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th></tr>
                </thead>
                <tbody id="adminTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ù† ÙˆÙ…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù‡ÙˆÙŠØ© ---
        function validateID(input, boxId) {
            const name = document.getElementById('custName').value.trim();
            if (name.split(' ').length < 4) {
                alert("âŒ Ø®Ø·Ø£ Ø£Ù…Ù†ÙŠ: ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù‡ÙˆÙŠØ© Ø£ÙˆÙ„Ø§Ù‹.");
                input.value = ""; return;
            }

            const img = new Image();
            img.src = URL.createObjectURL(input.files[0]);
            img.onload = function() {
                // ÙØ­Øµ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: ØµÙˆØ± Ø§Ù„Ù‡ÙˆÙŠØ© ØªÙƒÙˆÙ† Ø¨Ù†Ø³Ø¨ Ù…Ø¹ÙŠÙ†Ø©ØŒ ØµÙˆØ± Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© ØªÙƒÙˆÙ† Ø¹Ø±ÙŠØ¶Ø© Ø¬Ø¯Ø§Ù‹
                if (this.width > 3800 || this.height > 3800) {
                    alert("âŒ Ø±ÙØ¶ Ø§Ù„Ø­Ø¬Ø²: Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© Ù…Ù†Ø¸Ø± Ø·Ø¨ÙŠØ¹ÙŠ ÙˆÙ„ÙŠØ³Øª Ù…Ø³ØªÙ…Ø³ÙƒØ§Ù‹ Ø±Ø³Ù…ÙŠØ§Ù‹.");
                    input.value = ""; return;
                }
                document.getElementById('custName').readOnly = true;
                document.getElementById(boxId).style.borderColor = "#22c55e";
                checkReady();
            };
        }

        function checkReady() {
            if (document.getElementById('fId').files.length > 0 && document.getElementById('fRes').files.length > 0) {
                const btn = document.getElementById('bookBtn');
                btn.disabled = false;
                btn.className = "w-full py-6 bg-gold text-black rounded-3xl font-black text-xl shadow-2xl";
                btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² ÙˆØªØ³Ø¬ÙŠÙ„Ù‡ Ù…Ø§Ù„ÙŠØ§Ù‹ ğŸ§¾";
            }
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ---
        function confirmAndLog() {
            const name = document.getElementById('custName').value;
            const date = document.getElementById('bookDate').value;
            const price = document.getElementById('totalPrice').innerText;
            const phone = document.getElementById('custPhone').value;

            // 1. ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
            let ledger = JSON.parse(localStorage.getItem('masterLedger') || "[]");
            ledger.push({ name, date, price, phone, createdAt: new Date().toLocaleString() });
            localStorage.setItem('masterLedger', JSON.stringify(ledger));

            // 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù€ 24 Ø³Ø§Ø¹Ø© (Ø¹Ø¨Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©)
            const waMsg = `ğŸ“¢ *Ø¥Ø´Ø¹Ø§Ø± Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯*%0AğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}%0AğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}%0AğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${price}%0Aâš ï¸ *ØªÙ†Ø¨ÙŠÙ‡:* ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ°ÙƒÙŠØ± Ù„Ù„Ø²Ø¨ÙˆÙ† Ù‚Ø¨Ù„ 24 Ø³Ø§Ø¹Ø© Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø².`;
            
            alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ¥ØµØ¯Ø§Ø± Ø§Ù„ÙˆØµÙ„.");
            window.location.href = `https://wa.me/9647700000000?text=${waMsg}`;
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„Ø¨ÙˆØ§Ø¨Ø§Øª ---
        function auth(role) {
            const pass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
            if (role === 'admin' && pass === (localStorage.getItem('adminPass') || '1234')) {
                document.getElementById('adminOS').style.display = 'block';
                loadLedger();
            } else if (role === 'staff' && pass === 'staff') {
                document.getElementById('staffOS').style.display = 'block';
                loadStaffView();
            } else {
                alert("âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
            }
        }

        function loadLedger() {
            const ledger = JSON.parse(localStorage.getItem('masterLedger') || "[]");
            const tbody = document.getElementById('adminTableBody');
            let sum = 0;
            tbody.innerHTML = ledger.map(item => {
                sum += parseInt(item.price.replace(/,/g, ''));
                return `<tr><td>${item.name}</td><td>${item.date}</td><td>${item.price}</td><td>${item.createdAt}</td></tr>`;
            }).join('');
            document.getElementById('totalLedgerSum').innerText = sum.toLocaleString() + " Ø¯.Ø¹";
            document.getElementById('totalBookingsCount').innerText = ledger.length;
        }

        function loadStaffView() {
            const ledger = JSON.parse(localStorage.getItem('masterLedger') || "[]");
            const tbody = document.getElementById('staffTableBody');
            tbody.innerHTML = ledger.map(item => `<tr><td>${item.name}</td><td>${item.date}</td><td>${item.phone}</td><td class='text-green-500'>Ù…Ø¤ÙƒØ¯ âœ…</td></tr>`).join('');
        }

        function clearLedger() {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                localStorage.setItem('masterLedger', "[]");
                loadLedger();
            }
        }

        window.onload = function() {
            flatpickr("#bookDate", { minDate: "today", locale: "ar" });
        };
    </script>
</body>
</html>
