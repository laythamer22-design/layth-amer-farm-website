<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ | 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root { --gold: #c5a059; --dark: #0a0a0a; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--dark); color: white; }
        .royal-glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(15px); border: 1px solid rgba(197, 160, 89, 0.2); }
        .gold-text { color: var(--gold); }
        .receipt-card { width: 350px; background: white; color: black; padding: 20px; border: 10px double var(--gold); }
        .hidden-panel { display: none !important; }
    </style>
</head>
<body class="p-4 md:p-10" onload="initSystem()">

    <div class="max-w-6xl mx-auto mb-10 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-black gold-text italic">ROYAL CLOUD OASIS</h1>
            <p class="text-gray-500 text-sm">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø© 2026</p>
        </div>
        <button onclick="toggleAdmin()" class="royal-glass px-6 py-2 rounded-full text-xs font-bold border border-gold/30">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</button>
    </div>

    <section class="max-w-5xl mx-auto grid lg:grid-cols-2 gap-10">
        <div class="royal-glass p-8 rounded-[2rem] space-y-6">
            <h2 class="text-xl font-bold border-r-4 border-gold pr-4 text-white">Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†</h2>
            
            <div class="space-y-4">
                <input type="text" id="inName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:border-gold outline-none">
                
                <div class="grid grid-cols-2 gap-4">
                    <input type="tel" id="inPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:border-gold outline-none">
                    <input type="text" id="inDate" placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:border-gold outline-none">
                </div>

                <div class="relative h-32 w-full border-2 border-dashed border-white/10 rounded-xl flex flex-col items-center justify-center cursor-pointer overflow-hidden" id="uploadBox">
                    <i data-lucide="camera" class="text-gold/50"></i>
                    <span class="text-[10px] mt-2">Ø§Ø±ÙØ¹ Ø§Ù„Ù‡ÙˆÙŠØ© (ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø©)</span>
                    <input type="file" id="inID" class="absolute inset-0 opacity-0 cursor-pointer" onchange="processID(this)">
                    <img id="idPreview" class="absolute inset-0 w-full h-full object-cover hidden">
                </div>
            </div>

            <button id="bookBtn" onclick="executeBooking()" class="w-full bg-gold text-black font-black py-5 rounded-2xl shadow-lg shadow-gold/20 hover:scale-[1.01] transition">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹ ğŸ‘‘</button>
        </div>

        <div class="space-y-6">
            <div class="royal-glass p-8 rounded-[2rem]">
                <h3 class="text-sm font-bold text-gold mb-4 uppercase">Ø§Ù„ØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±</h3>
                <div id="syncStatus" class="flex items-center gap-2 text-xs text-green-500 font-bold">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div> Ù†Ø¸Ø§Ù… Supabase Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†
                </div>
                <div id="quickList" class="mt-4 space-y-3"></div>
            </div>
        </div>
    </section>

    <div id="receiptOverlay" class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-4 hidden-panel">
        <div class="flex flex-col items-center gap-6">
            <div id="printableReceipt" class="receipt-card">
                <div class="text-center border-b-2 border-black pb-4 mb-4">
                    <h2 class="text-2xl font-black uppercase">Royal Oasis</h2>
                    <p class="text-[9px] font-bold tracking-widest uppercase">Cloud Confirmed</p>
                </div>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between font-mono"><span>ID:</span><b id="rSerial">#0000</b></div>
                    <div class="flex justify-between"><span>Ø§Ù„Ø²Ø¨ÙˆÙ†:</span><span id="rName">-</span></div>
                    <div class="flex justify-between border-t border-black pt-2 font-black"><span>Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</span><span id="rPaid">-</span></div>
                </div>
                <div id="rQR" class="mt-6 flex justify-center"></div>
            </div>
            <button onclick="downloadReceipt()" class="bg-gold text-black px-10 py-3 rounded-xl font-bold">Ø­Ù…Ù„ Ø§Ù„ÙˆØµÙ„ ÙƒØµÙˆØ±Ø©</button>
            <button onclick="location.reload()" class="text-white opacity-50 text-xs uppercase">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨Ø© (Supabase)
        const SB_URL = 'YOUR_SUPABASE_URL'; 
        const SB_KEY = 'YOUR_SUPABASE_ANON_KEY';
        const supabase = window.supabase ? window.supabase.createClient(SB_URL, SB_KEY) : null;

        let bookings = [];
        let config = { price: 500000 };

        async function initSystem() {
            lucide.createIcons();
            await fetchBookings();
            
            flatpickr("#inDate", {
                disable: bookings.map(b => b.date),
                minDate: "today", theme: "dark"
            });
            updateQuickList();
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
        async function fetchBookings() {
            if(!supabase) return;
            const { data, error } = await supabase.from('bookings').select('*');
            if (data) bookings = data;
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø© ÙˆØ¶ØºØ·Ù‡Ø§
        function processID(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = 400; canvas.height = 300;
                        canvas.getContext('2d').drawImage(img, 0, 0, 400, 300);
                        document.getElementById('idPreview').src = canvas.toDataURL('image/jpeg', 0.6);
                        document.getElementById('idPreview').classList.remove('hidden');
                    };
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ù„Ø±ÙØ¹ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©
        async function executeBooking() {
            const btn = document.getElementById('bookBtn');
            const name = document.getElementById('inName').value;
            const phone = document.getElementById('inPhone').value;
            const date = document.getElementById('inDate').value;
            const idImg = document.getElementById('idPreview').src;

            if(!name || !phone || !date || !idImg) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

            btn.disabled = true;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...";

            const newBooking = {
                serial: "ROY-" + Math.floor(1000 + Math.random() * 9000),
                name, phone, date, idImg, amount: config.price / 2
            };

            // Ø§Ù„Ø±ÙØ¹ Ù„Ù€ Supabase
            if(supabase) {
                const { error } = await supabase.from('bookings').insert([newBooking]);
                if(error) console.error("Cloud Error", error);
            }

            showReceipt(newBooking);
        }

        function showReceipt(data) {
            document.getElementById('rSerial').innerText = data.serial;
            document.getElementById('rName').innerText = data.name;
            document.getElementById('rPaid').innerText = data.amount.toLocaleString() + " Ø¯.Ø¹";
            new QRCode(document.getElementById('rQR'), { text: data.serial, width: 90, height: 90 });
            document.getElementById('receiptOverlay').classList.remove('hidden-panel');
        }

        function downloadReceipt() {
            html2canvas(document.getElementById('printableReceipt')).then(canvas => {
                const link = document.createElement('a');
                link.download = `Receipt.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function updateQuickList() {
            const list = document.getElementById('quickList');
            list.innerHTML = bookings.slice(-3).reverse().map(b => `
                <div class="p-3 bg-white/5 rounded-lg border-r-2 border-gold text-xs flex justify-between">
                    <span>${b.name}</span> <span class="opacity-50">${b.date}</span>
                </div>
            `).join('');
        }

        function toggleAdmin() { /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© */ }
    </script>
</body>
</html>
