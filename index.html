<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام الإدارة الملكي | المزرعة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --gold: #c5a059; --dark: #050505; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--dark); color: white; scroll-behavior: smooth; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .gold-text { background: linear-gradient(135deg, #fceabb, #f8b500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .main-bg { position: fixed; inset: 0; z-index: -1; background-size: cover; background-position: center; }
        .admin-modal { display: none; position: fixed; inset: 0; z-index: 9999; background: #080808; overflow-y: auto; padding: 2rem; }
        .gallery-card { height: 350px; border-radius: 25px; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.1); }
        #receiptUI { background: white; color: black; padding: 2rem; width: 400px; border: 10px double #c5a059; display: none; margin: 20px auto; border-radius: 15px; }
        @media print { .no-print { display: none; } body { background: white; } }
    </style>
</head>
<body onload="initApp()">

    <div id="dynamicBg" class="main-bg"></div>
    <div class="fixed inset-0 bg-black/60 z-[-1]"></div>

    <nav class="fixed top-0 w-full z-50 glass border-b border-white/10 px-8 py-4 flex justify-between items-center">
        <h1 id="farmTitle" class="text-xl font-black gold-text italic tracking-widest">ROYAL FARM</h1>
        <button onclick="openAdmin()" class="bg-amber-600/10 border border-amber-500/50 text-amber-500 px-4 py-2 rounded-lg font-bold text-xs hover:bg-amber-600 hover:text-black transition">لوحة المدير</button>
    </nav>

    <section class="pt-32 pb-10 px-6">
        <div class="max-w-xl mx-auto glass p-8 rounded-[2.5rem] shadow-2xl border-amber-500/20">
            <h2 class="text-3xl font-black gold-text mb-6 text-center italic">نظام الحجز المباشر</h2>
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-amber-500 font-bold block mb-2 px-2">اسم المستأجر الكامل</label>
                    <input type="text" id="custName" class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none focus:border-amber-500 transition-all">
                </div>
                <div>
                    <label class="text-xs text-amber-500 font-bold block mb-2 px-2">تصنيف الحجز</label>
                    <select id="resType" class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none appearance-none">
                        <option value="عائلي">حجز عائلي خاص</option>
                        <option value="شبابي">تجمع شبابي</option>
                        <option value="مناسبة">مناسبة (عيد ميلاد/تخرج)</option>
                    </select>
                </div>
                <button onclick="processBooking()" class="w-full bg-amber-600 text-black font-black py-4 rounded-2xl text-lg hover:scale-[1.02] transition-transform shadow-[0_0_20px_rgba(197,160,89,0.3)]">تأكيد الحجز واستلام الوصل</button>
            </div>
        </div>
    </section>

    <div id="receiptUI" class="shadow-2xl font-bold">
        <div class="text-center border-b-2 border-black pb-4 mb-4">
            <h3 class="text-2xl font-black uppercase" id="recFarmName">ROYAL OASIS</h3>
            <p class="text-[10px] tracking-widest">OFFICIAL BOOKING RECEIPT</p>
        </div>
        <div class="space-y-3 text-right text-sm">
            <div class="flex justify-between"> <span id="recDate"></span> :التاريخ </div>
            <div class="flex justify-between font-mono"> <span id="recSerial"></span> :رقم الحجز </div>
            <hr class="border-black">
            <div class="flex justify-between"> <span id="recCust"></span> :السيد </div>
            <div class="flex justify-between"> <span id="recTotal"></span> :المبلغ الكلي </div>
            <div class="flex justify-between text-green-700 font-black"> <span id="recPaid"></span> :الواصل (50%) </div>
            <div class="flex justify-between text-red-600"> <span id="recDebt"></span> :المتبقي عند الدخول </div>
        </div>
        <div id="qrcode" class="flex justify-center my-6"></div>
        <button onclick="window.print()" class="no-print w-full bg-black text-white py-3 rounded-xl font-black">طباعة الوصل</button>
    </div>

    <section class="py-20 max-w-7xl mx-auto px-6">
        <div class="flex items-center gap-4 mb-12">
            <div class="h-[2px] flex-1 bg-amber-500/30"></div>
            <h3 class="text-2xl font-black gold-text">ألبوم مرافق المزرعة (JPG)</h3>
            <div class="h-[2px] flex-1 bg-amber-500/30"></div>
        </div>
        <div id="catalogGrid" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
    </section>

    <div id="adminPanel" class="admin-modal">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center border-b border-white/10 pb-6 mb-8">
                <div>
                    <h2 class="text-3xl font-black gold-text italic uppercase">Control Center</h2>
                    <p class="text-gray-500 text-xs">إدارة العمليات، الحسابات، والمحتوى البصري</p>
                </div>
                <button onclick="closeAdmin()" class="bg-red-500 text-white px-8 py-2 rounded-xl font-bold">خروج</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="glass p-8 rounded-[2rem] border-r-8 border-green-500">
                    <p class="text-gray-400 text-xs font-bold mb-2">إجمالي الواصل (المستلم فعلياً)</p>
                    <h4 id="statIncome" class="text-3xl font-black text-green-500">0 د.ع</h4>
                </div>
                <div class="glass p-8 rounded-[2rem] border-r-8 border-amber-500">
                    <p class="text-gray-400 text-xs font-bold mb-2">إجمالي المتبقي (في ذمة الزبائن)</p>
                    <h4 id="statDebt" class="text-3xl font-black text-amber-500">0 د.ع</h4>
                </div>
                <div class="glass p-8 rounded-[2rem] border-r-8 border-blue-500">
                    <p class="text-gray-400 text-xs font-bold mb-2">إجمالي قيمة الحجوزات الكلية</p>
                    <h4 id="statTotal" class="text-3xl font-black text-blue-500">0 د.ع</h4>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass p-8 rounded-[2.5rem] space-y-4">
                    <h5 class="text-amber-500 font-black border-b border-white/10 pb-4 mb-4">1- تفاصيل الموقع الأساسية</h5>
                    <div>
                        <label class="text-[10px] block mb-1 text-gray-400">اسم المزرعة الصريح</label>
                        <input type="text" id="setFarmName" class="w-full bg-black/50 p-4 rounded-xl border border-white/10">
                    </div>
                    <div>
                        <label class="text-[10px] block mb-1 text-gray-400">سعر الليلة الواحدة (د.ع)</label>
                        <input type="number" id="setPrice" class="w-full bg-black/50 p-4 rounded-xl border border-white/10">
                    </div>
                    <div>
                        <label class="text-[10px] block mb-1 text-gray-400">موقع المزرعة الوصفي</label>
                        <input type="text" id="setLoc" class="w-full bg-black/50 p-4 rounded-xl border border-white/10">
                    </div>
                    <button onclick="saveSettings()" class="w-full bg-white text-black py-4 rounded-xl font-black">حفظ التعديلات الأساسية</button>
                </div>

                <div class="glass p-8 rounded-[2.5rem] space-y-4">
                    <h5 class="text-blue-500 font-black border-b border-white/10 pb-4 mb-4">2- بوابات الميديا (JPG)</h5>
                    <div>
                        <label class="text-[10px] block mb-1 text-blue-400 font-bold">بوابة صورة ثيم الموقع العام</label>
                        <input type="text" id="setMainBg" placeholder="ضع رابط صورة الخلفية هنا" class="w-full bg-black/50 p-4 rounded-xl border border-blue-500/30 text-xs font-mono">
                    </div>
                    <div>
                        <label class="text-[10px] block mb-1 text-amber-400 font-bold">بوابة ألبوم مرافق المزرعة (روابط منفصلة)</label>
                        <textarea id="setCatalogImgs" placeholder="ضع كل رابط صورة في سطر جديد" class="w-full bg-black/50 p-4 rounded-xl border border-amber-500/30 h-32 text-xs font-mono"></textarea>
                    </div>
                    <button onclick="updateVisuals()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black shadow-lg">تحديث كافة الصور</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('royal_db')) || [];
        let config = JSON.parse(localStorage.getItem('royal_config')) || {
            name: "مزرعة العائلة الملكية", price: 200000, loc: "الرمادي - أطراف الفلوجة", 
            bg: "https://images.unsplash.com/photo-1580587771525-78b9dba3b914",
            catalog: ["https://images.unsplash.com/photo-1600585154340-be6161a56a0c"], pass: "1234"
        };

        function initApp() {
            document.getElementById('farmTitle').innerText = config.name;
            document.getElementById('dynamicBg').style.backgroundImage = `url(${config.bg})`;
            renderCatalog();
            updateStats();
        }

        function processBooking() {
            const name = document.getElementById('custName').value;
            if(!name) return alert("الرجاء كتابة اسم المستأجر");

            const booking = {
                id: Date.now(),
                serial: "RF-" + Math.floor(Math.random()*89999 + 10000),
                name: name,
                type: document.getElementById('resType').value,
                total: config.price,
                date: new Date().toLocaleDateString('ar-EG')
            };

            db.push(booking);
            localStorage.setItem('royal_db', JSON.stringify(db));
            showReceipt(booking);
            updateStats();
        }

        function showReceipt(b) {
            const ui = document.getElementById('receiptUI');
            ui.style.display = 'block';
            document.getElementById('recFarmName').innerText = config.name;
            document.getElementById('recCust').innerText = b.name;
            document.getElementById('recTotal').innerText = b.total.toLocaleString() + " د.ع";
            document.getElementById('recPaid').innerText = (b.total * 0.5).toLocaleString() + " د.ع";
            document.getElementById('recDebt').innerText = (b.total * 0.5).toLocaleString() + " د.ع";
            document.getElementById('recSerial').innerText = b.serial;
            document.getElementById('recDate').innerText = b.date;

            document.getElementById('qrcode').innerHTML = "";
            new QRCode(document.getElementById("qrcode"), { text: b.serial, width: 120, height: 120 });
            ui.scrollIntoView({ behavior: 'smooth' });
        }

        function renderCatalog() {
            document.getElementById('catalogGrid').innerHTML = config.catalog.map((url, i) => `
                <div class="gallery-card glass group">
                    <img src="${url}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex items-end p-6">
                        <span class="text-amber-500 font-black italic text-sm">مرفق JPG #${i+1}</span>
                    </div>
                </div>
            `).join('');
        }

        function openAdmin() {
            if(prompt("كلمة سر المدير:") === config.pass) {
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('setFarmName').value = config.name;
                document.getElementById('setPrice').value = config.price;
                document.getElementById('setLoc').value = config.loc;
                document.getElementById('setMainBg').value = config.bg;
                document.getElementById('setCatalogImgs').value = config.catalog.join('\n');
                updateStats();
            }
        }

        function saveSettings() {
            config.name = document.getElementById('setFarmName').value;
            config.price = parseInt(document.getElementById('setPrice').value);
            config.loc = document.getElementById('setLoc').value;
            localStorage.setItem('royal_config', JSON.stringify(config));
            alert("تم تحديث البيانات ✅");
            location.reload();
        }

        function updateVisuals() {
            config.bg = document.getElementById('setMainBg').value;
            config.catalog = document.getElementById('setCatalogImgs').value.split('\n').filter(r => r.trim() !== "");
            localStorage.setItem('royal_config', JSON.stringify(config));
            alert("تم تحديث البوابات البصرية ✅");
            location.reload();
        }

        function updateStats() {
            let total = 0;
            db.forEach(b => total += b.total);
            document.getElementById('statTotal').innerText = total.toLocaleString() + " د.ع";
            document.getElementById('statIncome').innerText = (total * 0.5).toLocaleString() + " د.ع";
            document.getElementById('statDebt').innerText = (total * 0.5).toLocaleString() + " د.ع";
        }

        function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }
    </script>
</body>
</html>
